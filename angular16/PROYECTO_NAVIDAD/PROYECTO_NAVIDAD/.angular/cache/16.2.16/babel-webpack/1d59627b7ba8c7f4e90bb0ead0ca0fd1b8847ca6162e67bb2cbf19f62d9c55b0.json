{"ast":null,"code":"import { signal, inject, computed } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { Router } from '@angular/router';\nimport * as i0 from \"@angular/core\";\nexport class AuthService {\n  constructor() {\n    this.url = 'http://localhost:3000';\n    this.http = inject(HttpClient);\n    this.router = inject(Router);\n    // Signals para el estado del usuario [cite: 85]\n    this.usuario = signal(null);\n    this.isLoggedIn = signal(false);\n    // Solución al error isAdmin: Creamos un signal computado \n    this.isAdmin = computed(() => this.usuario()?.rol === 'administrador');\n  }\n  login(datos) {\n    return this.http.get(`${this.url}/accesoDB`).subscribe({\n      next: usuarios => {\n        const user = usuarios.find(u => u.username === datos.username && u.password === datos.password);\n        if (user) {\n          this.usuario.set(user);\n          this.isLoggedIn.set(true);\n          this.router.navigate(['/inicio']);\n        } else {\n          alert(\"Credenciales incorrectas\");\n        }\n      }\n    });\n  }\n  // Solución al error de registro: Añadimos la función \n  registro(nombre, username, password, imagen) {\n    const nuevoUsuario = {\n      nombre,\n      username,\n      password,\n      rol: 'usuario',\n      imagen // Aquí se guarda el Base64 [cite: 52]\n    };\n\n    return this.http.post(`${this.url}/accesoDB`, nuevoUsuario).subscribe({\n      next: () => {\n        alert(\"Registro completado con éxito\");\n        this.router.navigate(['/login']);\n      },\n      error: () => alert(\"Error al registrar el usuario\")\n    });\n  }\n  // Solución al error logout [cite: 19]\n  logout() {\n    this.usuario.set(null);\n    this.isLoggedIn.set(false);\n    this.router.navigate(['/login']);\n  }\n  static {\n    this.ɵfac = function AuthService_Factory(t) {\n      return new (t || AuthService)();\n    };\n  }\n  static {\n    this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: AuthService,\n      factory: AuthService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n}","map":{"version":3,"names":["signal","inject","computed","HttpClient","Router","AuthService","constructor","url","http","router","usuario","isLoggedIn","isAdmin","rol","login","datos","get","subscribe","next","usuarios","user","find","u","username","password","set","navigate","alert","registro","nombre","imagen","nuevoUsuario","post","error","logout","factory","ɵfac","providedIn"],"sources":["/usr/src/app/PROYECTO_NAVIDAD/PROYECTO_NAVIDAD/src/app/servicios/auth.service.ts"],"sourcesContent":["import { Injectable, signal, inject, Computed, computed } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { Router } from '@angular/router';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class AuthService {\n  private url: string = 'http://localhost:3000';\n  private http = inject(HttpClient);\n  private router = inject(Router);\n\n  // Signals para el estado del usuario [cite: 85]\n  public usuario = signal<any>(null);\n  public isLoggedIn = signal<boolean>(false);\n\n  // Solución al error isAdmin: Creamos un signal computado \n  public isAdmin = computed(() => this.usuario()?.rol === 'administrador');\n\n  login(datos: any) {\n    return this.http.get<any[]>(`${this.url}/accesoDB`).subscribe({\n      next: (usuarios) => {\n        const user = usuarios.find(u => u.username === datos.username && u.password === datos.password);\n        if (user) {\n          this.usuario.set(user);\n          this.isLoggedIn.set(true);\n          this.router.navigate(['/inicio']);\n        } else {\n          alert(\"Credenciales incorrectas\");\n        }\n      }\n    });\n  }\n\n  // Solución al error de registro: Añadimos la función \n  registro(nombre: string, username: string, password: string, imagen: string) {\n    const nuevoUsuario = {\n      nombre,\n      username,\n      password,\n      rol: 'usuario', // Por defecto se registran como usuarios [cite: 11]\n      imagen // Aquí se guarda el Base64 [cite: 52]\n    };\n\n    return this.http.post(`${this.url}/accesoDB`, nuevoUsuario).subscribe({\n      next: () => {\n        alert(\"Registro completado con éxito\");\n        this.router.navigate(['/login']);\n      },\n      error: () => alert(\"Error al registrar el usuario\")\n    });\n  }\n\n  // Solución al error logout [cite: 19]\n  logout() {\n    this.usuario.set(null);\n    this.isLoggedIn.set(false);\n    this.router.navigate(['/login']);\n  }\n}"],"mappings":"AAAA,SAAqBA,MAAM,EAAEC,MAAM,EAAYC,QAAQ,QAAQ,eAAe;AAC9E,SAASC,UAAU,QAAQ,sBAAsB;AACjD,SAASC,MAAM,QAAQ,iBAAiB;;AAKxC,OAAM,MAAOC,WAAW;EAHxBC,YAAA;IAIU,KAAAC,GAAG,GAAW,uBAAuB;IACrC,KAAAC,IAAI,GAAGP,MAAM,CAACE,UAAU,CAAC;IACzB,KAAAM,MAAM,GAAGR,MAAM,CAACG,MAAM,CAAC;IAE/B;IACO,KAAAM,OAAO,GAAGV,MAAM,CAAM,IAAI,CAAC;IAC3B,KAAAW,UAAU,GAAGX,MAAM,CAAU,KAAK,CAAC;IAE1C;IACO,KAAAY,OAAO,GAAGV,QAAQ,CAAC,MAAM,IAAI,CAACQ,OAAO,EAAE,EAAEG,GAAG,KAAK,eAAe,CAAC;;EAExEC,KAAKA,CAACC,KAAU;IACd,OAAO,IAAI,CAACP,IAAI,CAACQ,GAAG,CAAQ,GAAG,IAAI,CAACT,GAAG,WAAW,CAAC,CAACU,SAAS,CAAC;MAC5DC,IAAI,EAAGC,QAAQ,IAAI;QACjB,MAAMC,IAAI,GAAGD,QAAQ,CAACE,IAAI,CAACC,CAAC,IAAIA,CAAC,CAACC,QAAQ,KAAKR,KAAK,CAACQ,QAAQ,IAAID,CAAC,CAACE,QAAQ,KAAKT,KAAK,CAACS,QAAQ,CAAC;QAC/F,IAAIJ,IAAI,EAAE;UACR,IAAI,CAACV,OAAO,CAACe,GAAG,CAACL,IAAI,CAAC;UACtB,IAAI,CAACT,UAAU,CAACc,GAAG,CAAC,IAAI,CAAC;UACzB,IAAI,CAAChB,MAAM,CAACiB,QAAQ,CAAC,CAAC,SAAS,CAAC,CAAC;SAClC,MAAM;UACLC,KAAK,CAAC,0BAA0B,CAAC;;MAErC;KACD,CAAC;EACJ;EAEA;EACAC,QAAQA,CAACC,MAAc,EAAEN,QAAgB,EAAEC,QAAgB,EAAEM,MAAc;IACzE,MAAMC,YAAY,GAAG;MACnBF,MAAM;MACNN,QAAQ;MACRC,QAAQ;MACRX,GAAG,EAAE,SAAS;MACdiB,MAAM,CAAC;KACR;;IAED,OAAO,IAAI,CAACtB,IAAI,CAACwB,IAAI,CAAC,GAAG,IAAI,CAACzB,GAAG,WAAW,EAAEwB,YAAY,CAAC,CAACd,SAAS,CAAC;MACpEC,IAAI,EAAEA,CAAA,KAAK;QACTS,KAAK,CAAC,+BAA+B,CAAC;QACtC,IAAI,CAAClB,MAAM,CAACiB,QAAQ,CAAC,CAAC,QAAQ,CAAC,CAAC;MAClC,CAAC;MACDO,KAAK,EAAEA,CAAA,KAAMN,KAAK,CAAC,+BAA+B;KACnD,CAAC;EACJ;EAEA;EACAO,MAAMA,CAAA;IACJ,IAAI,CAACxB,OAAO,CAACe,GAAG,CAAC,IAAI,CAAC;IACtB,IAAI,CAACd,UAAU,CAACc,GAAG,CAAC,KAAK,CAAC;IAC1B,IAAI,CAAChB,MAAM,CAACiB,QAAQ,CAAC,CAAC,QAAQ,CAAC,CAAC;EAClC;;;uBAnDWrB,WAAW;IAAA;EAAA;;;aAAXA,WAAW;MAAA8B,OAAA,EAAX9B,WAAW,CAAA+B,IAAA;MAAAC,UAAA,EAFV;IAAM;EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}