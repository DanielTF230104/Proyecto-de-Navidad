{"ast":null,"code":"import { signal, computed, inject } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { AccesoApiService } from './acceso-api.service';\nimport { HttpClient } from '@angular/common/http'; // Importa HttpClient\nimport * as i0 from \"@angular/core\";\nexport class AuthService {\n  constructor() {\n    this.http = inject(HttpClient);\n    this.accesoApi = inject(AccesoApiService);\n    this.router = inject(Router);\n    this._isLoggedIn = signal(false);\n    this.isLoggedIn = this._isLoggedIn.asReadonly();\n    this._usuario = signal(null);\n    this.usuario = this._usuario.asReadonly();\n    // Requisito 1: Signal computado para saber si es Admin\n    // Signal que detecta si el usuario es admin\n    this.isAdmin = computed(() => this._usuario()?.rol === 'administrador');\n  }\n  login(username, password) {\n    this.accesoApi.login(username, password).subscribe({\n      next: resp => {\n        console.log(\"Respuesta del servidor:\", resp);\n        if (resp && resp.ok) {\n          // Ahora que el servidor manda 'ok', es más simple\n          // Extraemos el objeto usuario que viene dentro de la respuesta\n          const datosUsuario = resp.usuario;\n          this._isLoggedIn.set(true);\n          this._usuario.set(datosUsuario); // Esto es lo que activa el computed isAdmin\n          // Guardamos en localStorage para que no se borre al refrescar\n          localStorage.setItem('username', datosUsuario.username);\n          localStorage.setItem('rol', datosUsuario.rol);\n          console.log(\"Login exitoso. Rol detectado:\", datosUsuario.rol);\n          this.router.navigate(['/inicio']);\n        } else {\n          alert(resp.mensaje || \"Credenciales incorrectas\");\n        }\n      },\n      error: err => {\n        console.error(\"Error en el login:\", err);\n        alert(\"Error al conectar con el servidor\");\n      }\n    });\n  }\n  // Quitamos 'rol' de los argumentos de la función principal\n  registro(nombre, username, pass, imagen, rol) {\n    const body = {\n      nombre,\n      username,\n      pass,\n      imagen,\n      rol\n    };\n    // Eliminamos los \"...\" y simplemente retornamos el observable\n    return this.http.post('http://localhost:3000/usuarios/grabar', body);\n  }\n  logout() {\n    this._isLoggedIn.set(false);\n    this._usuario.set(null);\n    localStorage.clear();\n    this.router.navigate(['/login']);\n  }\n  static {\n    this.ɵfac = function AuthService_Factory(t) {\n      return new (t || AuthService)();\n    };\n  }\n  static {\n    this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: AuthService,\n      factory: AuthService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n}","map":{"version":3,"names":["signal","computed","inject","Router","AccesoApiService","HttpClient","AuthService","constructor","http","accesoApi","router","_isLoggedIn","isLoggedIn","asReadonly","_usuario","usuario","isAdmin","rol","login","username","password","subscribe","next","resp","console","log","ok","datosUsuario","set","localStorage","setItem","navigate","alert","mensaje","error","err","registro","nombre","pass","imagen","body","post","logout","clear","factory","ɵfac","providedIn"],"sources":["/usr/src/app/PROYECTO_NAVIDAD/PROYECTO_NAVIDAD/src/app/servicios/auth.service.ts"],"sourcesContent":["import { Injectable, signal, computed, inject } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { AccesoApiService } from './acceso-api.service';\nimport { HttpClient } from '@angular/common/http'; // Importa HttpClient\n\n@Injectable({ providedIn: 'root' })\nexport class AuthService {\n  private http = inject(HttpClient);\n  private accesoApi = inject(AccesoApiService);\n  private router = inject(Router);\n\n  private _isLoggedIn = signal(false);\n  isLoggedIn = this._isLoggedIn.asReadonly();\n\n  public _usuario = signal<any | null>(null);\n  usuario = this._usuario.asReadonly();\n\n  // Requisito 1: Signal computado para saber si es Admin\n  // Signal que detecta si el usuario es admin\n  public isAdmin = computed(() => this._usuario()?.rol === 'administrador');\n  login(username: string, password: string): void {\n  this.accesoApi.login(username, password).subscribe({\n    next: (resp) => {\n      console.log(\"Respuesta del servidor:\", resp);\n\n      if (resp && resp.ok) { // Ahora que el servidor manda 'ok', es más simple\n        \n        // Extraemos el objeto usuario que viene dentro de la respuesta\n        const datosUsuario = resp.usuario; \n\n        this._isLoggedIn.set(true);\n        this._usuario.set(datosUsuario); // Esto es lo que activa el computed isAdmin\n        \n        // Guardamos en localStorage para que no se borre al refrescar\n        localStorage.setItem('username', datosUsuario.username);\n        localStorage.setItem('rol', datosUsuario.rol);\n\n        console.log(\"Login exitoso. Rol detectado:\", datosUsuario.rol);\n        this.router.navigate(['/inicio']); \n      } else {\n        alert(resp.mensaje || \"Credenciales incorrectas\");\n      }\n    },\n    error: (err) => {\n      console.error(\"Error en el login:\", err);\n      alert(\"Error al conectar con el servidor\");\n    }\n  });\n}\n\n  // Quitamos 'rol' de los argumentos de la función principal\n  registro(nombre: string, username: string, pass: string, imagen: string, rol: string) {\n    const body = { nombre, username, pass, imagen, rol };\n    // Eliminamos los \"...\" y simplemente retornamos el observable\n    return this.http.post('http://localhost:3000/usuarios/grabar', body);\n}\n\n  logout(): void {\n    this._isLoggedIn.set(false);\n    this._usuario.set(null);\n    localStorage.clear();\n    this.router.navigate(['/login']);\n  }\n}"],"mappings":"AAAA,SAAqBA,MAAM,EAAEC,QAAQ,EAAEC,MAAM,QAAQ,eAAe;AACpE,SAASC,MAAM,QAAQ,iBAAiB;AACxC,SAASC,gBAAgB,QAAQ,sBAAsB;AACvD,SAASC,UAAU,QAAQ,sBAAsB,CAAC,CAAC;;AAGnD,OAAM,MAAOC,WAAW;EADxBC,YAAA;IAEU,KAAAC,IAAI,GAAGN,MAAM,CAACG,UAAU,CAAC;IACzB,KAAAI,SAAS,GAAGP,MAAM,CAACE,gBAAgB,CAAC;IACpC,KAAAM,MAAM,GAAGR,MAAM,CAACC,MAAM,CAAC;IAEvB,KAAAQ,WAAW,GAAGX,MAAM,CAAC,KAAK,CAAC;IACnC,KAAAY,UAAU,GAAG,IAAI,CAACD,WAAW,CAACE,UAAU,EAAE;IAEnC,KAAAC,QAAQ,GAAGd,MAAM,CAAa,IAAI,CAAC;IAC1C,KAAAe,OAAO,GAAG,IAAI,CAACD,QAAQ,CAACD,UAAU,EAAE;IAEpC;IACA;IACO,KAAAG,OAAO,GAAGf,QAAQ,CAAC,MAAM,IAAI,CAACa,QAAQ,EAAE,EAAEG,GAAG,KAAK,eAAe,CAAC;;EACzEC,KAAKA,CAACC,QAAgB,EAAEC,QAAgB;IACxC,IAAI,CAACX,SAAS,CAACS,KAAK,CAACC,QAAQ,EAAEC,QAAQ,CAAC,CAACC,SAAS,CAAC;MACjDC,IAAI,EAAGC,IAAI,IAAI;QACbC,OAAO,CAACC,GAAG,CAAC,yBAAyB,EAAEF,IAAI,CAAC;QAE5C,IAAIA,IAAI,IAAIA,IAAI,CAACG,EAAE,EAAE;UAAE;UAErB;UACA,MAAMC,YAAY,GAAGJ,IAAI,CAACR,OAAO;UAEjC,IAAI,CAACJ,WAAW,CAACiB,GAAG,CAAC,IAAI,CAAC;UAC1B,IAAI,CAACd,QAAQ,CAACc,GAAG,CAACD,YAAY,CAAC,CAAC,CAAC;UAEjC;UACAE,YAAY,CAACC,OAAO,CAAC,UAAU,EAAEH,YAAY,CAACR,QAAQ,CAAC;UACvDU,YAAY,CAACC,OAAO,CAAC,KAAK,EAAEH,YAAY,CAACV,GAAG,CAAC;UAE7CO,OAAO,CAACC,GAAG,CAAC,+BAA+B,EAAEE,YAAY,CAACV,GAAG,CAAC;UAC9D,IAAI,CAACP,MAAM,CAACqB,QAAQ,CAAC,CAAC,SAAS,CAAC,CAAC;SAClC,MAAM;UACLC,KAAK,CAACT,IAAI,CAACU,OAAO,IAAI,0BAA0B,CAAC;;MAErD,CAAC;MACDC,KAAK,EAAGC,GAAG,IAAI;QACbX,OAAO,CAACU,KAAK,CAAC,oBAAoB,EAAEC,GAAG,CAAC;QACxCH,KAAK,CAAC,mCAAmC,CAAC;MAC5C;KACD,CAAC;EACJ;EAEE;EACAI,QAAQA,CAACC,MAAc,EAAElB,QAAgB,EAAEmB,IAAY,EAAEC,MAAc,EAAEtB,GAAW;IAClF,MAAMuB,IAAI,GAAG;MAAEH,MAAM;MAAElB,QAAQ;MAAEmB,IAAI;MAAEC,MAAM;MAAEtB;IAAG,CAAE;IACpD;IACA,OAAO,IAAI,CAACT,IAAI,CAACiC,IAAI,CAAC,uCAAuC,EAAED,IAAI,CAAC;EACxE;EAEEE,MAAMA,CAAA;IACJ,IAAI,CAAC/B,WAAW,CAACiB,GAAG,CAAC,KAAK,CAAC;IAC3B,IAAI,CAACd,QAAQ,CAACc,GAAG,CAAC,IAAI,CAAC;IACvBC,YAAY,CAACc,KAAK,EAAE;IACpB,IAAI,CAACjC,MAAM,CAACqB,QAAQ,CAAC,CAAC,QAAQ,CAAC,CAAC;EAClC;;;uBAxDWzB,WAAW;IAAA;EAAA;;;aAAXA,WAAW;MAAAsC,OAAA,EAAXtC,WAAW,CAAAuC,IAAA;MAAAC,UAAA,EADE;IAAM;EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}