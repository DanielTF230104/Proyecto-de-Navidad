{"ast":null,"code":"// /app/servicios/auth.service.ts\nimport { signal, computed } from '@angular/core'; // Añadimos computed\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"./acceso-api.service\";\nimport * as i2 from \"@angular/router\";\nexport class AuthService {\n  constructor(accesoApi, router) {\n    this.accesoApi = accesoApi;\n    this.router = router;\n    this.isLoggedIn = signal(false);\n    this.usuario = signal(null);\n    // NUEVO: Una señal computada para saber si es admin fácilmente\n    this.isAdmin = computed(() => this.usuario()?.rol === 'administrador');\n  }\n  login(datos) {\n    return this.http.get(`${this.url}/accesoDB`).subscribe(usuarios => {\n      const user = usuarios.find(u => u.username === datos.username && u.password === datos.password);\n      if (user) {\n        this.usuario.set(user); // Aquí se guarda el ROL \n        this.isLoggedIn.set(true);\n        this.router.navigate(['/inicio']);\n      } else {\n        alert(\"Credenciales incorrectas\");\n      }\n    });\n  }\n  // Modificamos el registro para que acepte la imagen\n  registro(nombre, username, password, imagen = '') {\n    // Por defecto, al registrarse son 'usuario'\n    const rol = 'usuario';\n    this.accesoApi.registro(nombre, username, password, rol, imagen).subscribe({\n      next: response => {\n        if (response.ok) {\n          this.router.navigate(['/login']);\n        }\n      },\n      error: () => console.error('Error en el registro')\n    });\n  }\n  logout() {\n    this.isLoggedIn.set(false);\n    this.usuario.set(null);\n    this.router.navigate(['/login']);\n  }\n  static {\n    this.ɵfac = function AuthService_Factory(t) {\n      return new (t || AuthService)(i0.ɵɵinject(i1.AccesoApiService), i0.ɵɵinject(i2.Router));\n    };\n  }\n  static {\n    this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: AuthService,\n      factory: AuthService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n}","map":{"version":3,"names":["signal","computed","AuthService","constructor","accesoApi","router","isLoggedIn","usuario","isAdmin","rol","login","datos","http","get","url","subscribe","usuarios","user","find","u","username","password","set","navigate","alert","registro","nombre","imagen","next","response","ok","error","console","logout","i0","ɵɵinject","i1","AccesoApiService","i2","Router","factory","ɵfac","providedIn"],"sources":["/usr/src/app/PROYECTO_NAVIDAD/PROYECTO_NAVIDAD/src/app/servicios/auth.service.ts"],"sourcesContent":["// /app/servicios/auth.service.ts\nimport { Injectable, signal, computed } from '@angular/core'; // Añadimos computed\nimport { AccesoApiService } from './acceso-api.service';\nimport { Router } from '@angular/router';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class AuthService {\n  public isLoggedIn = signal<boolean>(false);\n  public usuario = signal<any>(null);\n\n  // NUEVO: Una señal computada para saber si es admin fácilmente\n  public isAdmin = computed(() => this.usuario()?.rol === 'administrador');\n\n  constructor(\n    private accesoApi: AccesoApiService,\n    private router: Router\n  ) { }\n\n  login(datos: any) {\n  return this.http.get<any[]>(`${this.url}/accesoDB`).subscribe(usuarios => {\n    const user = usuarios.find(u => u.username === datos.username && u.password === datos.password);\n    if (user) {\n      this.usuario.set(user); // Aquí se guarda el ROL \n      this.isLoggedIn.set(true);\n      this.router.navigate(['/inicio']);\n    } else {\n      alert(\"Credenciales incorrectas\");\n    }\n  });\n}\n\n  // Modificamos el registro para que acepte la imagen\n  registro(nombre: string, username: string, password: string, imagen: string = '') {\n    // Por defecto, al registrarse son 'usuario'\n    const rol = 'usuario'; \n    this.accesoApi.registro(nombre, username, password, rol, imagen)\n      .subscribe({\n        next: (response) => {\n          if (response.ok) {\n            this.router.navigate(['/login']);\n          }\n        },\n        error: () => console.error('Error en el registro')\n      });\n  }\n\n  logout() {\n    this.isLoggedIn.set(false);\n    this.usuario.set(null);\n    this.router.navigate(['/login']);\n  }\n}"],"mappings":"AAAA;AACA,SAAqBA,MAAM,EAAEC,QAAQ,QAAQ,eAAe,CAAC,CAAC;;;;AAO9D,OAAM,MAAOC,WAAW;EAOtBC,YACUC,SAA2B,EAC3BC,MAAc;IADd,KAAAD,SAAS,GAATA,SAAS;IACT,KAAAC,MAAM,GAANA,MAAM;IART,KAAAC,UAAU,GAAGN,MAAM,CAAU,KAAK,CAAC;IACnC,KAAAO,OAAO,GAAGP,MAAM,CAAM,IAAI,CAAC;IAElC;IACO,KAAAQ,OAAO,GAAGP,QAAQ,CAAC,MAAM,IAAI,CAACM,OAAO,EAAE,EAAEE,GAAG,KAAK,eAAe,CAAC;EAKpE;EAEJC,KAAKA,CAACC,KAAU;IAChB,OAAO,IAAI,CAACC,IAAI,CAACC,GAAG,CAAQ,GAAG,IAAI,CAACC,GAAG,WAAW,CAAC,CAACC,SAAS,CAACC,QAAQ,IAAG;MACvE,MAAMC,IAAI,GAAGD,QAAQ,CAACE,IAAI,CAACC,CAAC,IAAIA,CAAC,CAACC,QAAQ,KAAKT,KAAK,CAACS,QAAQ,IAAID,CAAC,CAACE,QAAQ,KAAKV,KAAK,CAACU,QAAQ,CAAC;MAC/F,IAAIJ,IAAI,EAAE;QACR,IAAI,CAACV,OAAO,CAACe,GAAG,CAACL,IAAI,CAAC,CAAC,CAAC;QACxB,IAAI,CAACX,UAAU,CAACgB,GAAG,CAAC,IAAI,CAAC;QACzB,IAAI,CAACjB,MAAM,CAACkB,QAAQ,CAAC,CAAC,SAAS,CAAC,CAAC;OAClC,MAAM;QACLC,KAAK,CAAC,0BAA0B,CAAC;;IAErC,CAAC,CAAC;EACJ;EAEE;EACAC,QAAQA,CAACC,MAAc,EAAEN,QAAgB,EAAEC,QAAgB,EAAEM,MAAA,GAAiB,EAAE;IAC9E;IACA,MAAMlB,GAAG,GAAG,SAAS;IACrB,IAAI,CAACL,SAAS,CAACqB,QAAQ,CAACC,MAAM,EAAEN,QAAQ,EAAEC,QAAQ,EAAEZ,GAAG,EAAEkB,MAAM,CAAC,CAC7DZ,SAAS,CAAC;MACTa,IAAI,EAAGC,QAAQ,IAAI;QACjB,IAAIA,QAAQ,CAACC,EAAE,EAAE;UACf,IAAI,CAACzB,MAAM,CAACkB,QAAQ,CAAC,CAAC,QAAQ,CAAC,CAAC;;MAEpC,CAAC;MACDQ,KAAK,EAAEA,CAAA,KAAMC,OAAO,CAACD,KAAK,CAAC,sBAAsB;KAClD,CAAC;EACN;EAEAE,MAAMA,CAAA;IACJ,IAAI,CAAC3B,UAAU,CAACgB,GAAG,CAAC,KAAK,CAAC;IAC1B,IAAI,CAACf,OAAO,CAACe,GAAG,CAAC,IAAI,CAAC;IACtB,IAAI,CAACjB,MAAM,CAACkB,QAAQ,CAAC,CAAC,QAAQ,CAAC,CAAC;EAClC;;;uBA5CWrB,WAAW,EAAAgC,EAAA,CAAAC,QAAA,CAAAC,EAAA,CAAAC,gBAAA,GAAAH,EAAA,CAAAC,QAAA,CAAAG,EAAA,CAAAC,MAAA;IAAA;EAAA;;;aAAXrC,WAAW;MAAAsC,OAAA,EAAXtC,WAAW,CAAAuC,IAAA;MAAAC,UAAA,EAFV;IAAM;EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}