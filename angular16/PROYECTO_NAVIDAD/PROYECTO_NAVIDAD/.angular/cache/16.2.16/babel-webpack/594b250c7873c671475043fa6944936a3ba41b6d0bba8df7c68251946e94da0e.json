{"ast":null,"code":"import { signal, computed, inject } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { AccesoApiService } from './acceso-api.service';\nimport * as i0 from \"@angular/core\";\nexport class AuthService {\n  constructor() {\n    this.accesoApi = inject(AccesoApiService);\n    this.router = inject(Router);\n    this._isLoggedIn = signal(false);\n    this.isLoggedIn = this._isLoggedIn.asReadonly();\n    this._usuario = signal(null);\n    this.usuario = this._usuario.asReadonly();\n    // Requisito 1: Signal computado para saber si es Admin\n    this.isAdmin = computed(() => this._usuario()?.rol === 'administrador');\n  }\n  login(username, password) {\n    this.accesoApi.login(username, password).subscribe({\n      next: resp => {\n        if (resp.ok) {\n          this._isLoggedIn.set(true);\n          this._usuario.set(resp.usuario);\n          localStorage.setItem('username', resp.usuario.username);\n          localStorage.setItem('rol', resp.usuario.rol); // Guardamos rol\n          this.router.navigate(['/inicio']);\n        }\n      }\n    });\n  }\n  // Quitamos 'rol' de los argumentos de la función principal\n  registro(nombre, username, password, imagen) {\n    // El rol se define aquí dentro antes de enviarlo a la API\n    const rol = 'usuario';\n    this.accesoApi.registro(nombre, username, password, imagen).subscribe({\n      next: resp => {\n        if (resp.ok) this.router.navigate(['/login']);\n      }\n    });\n  }\n  logout() {\n    this._isLoggedIn.set(false);\n    this._usuario.set(null);\n    localStorage.clear();\n    this.router.navigate(['/login']);\n  }\n  static {\n    this.ɵfac = function AuthService_Factory(t) {\n      return new (t || AuthService)();\n    };\n  }\n  static {\n    this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: AuthService,\n      factory: AuthService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n}","map":{"version":3,"names":["signal","computed","inject","Router","AccesoApiService","AuthService","constructor","accesoApi","router","_isLoggedIn","isLoggedIn","asReadonly","_usuario","usuario","isAdmin","rol","login","username","password","subscribe","next","resp","ok","set","localStorage","setItem","navigate","registro","nombre","imagen","logout","clear","factory","ɵfac","providedIn"],"sources":["/usr/src/app/PROYECTO_NAVIDAD/PROYECTO_NAVIDAD/src/app/servicios/auth.service.ts"],"sourcesContent":["import { Injectable, signal, computed, inject } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { AccesoApiService } from './acceso-api.service';\n\n@Injectable({ providedIn: 'root' })\nexport class AuthService {\n  private accesoApi = inject(AccesoApiService);\n  private router = inject(Router);\n\n  private _isLoggedIn = signal(false);\n  isLoggedIn = this._isLoggedIn.asReadonly();\n\n  public _usuario = signal<any | null>(null);\n  usuario = this._usuario.asReadonly();\n\n  // Requisito 1: Signal computado para saber si es Admin\n  public isAdmin = computed(() => this._usuario()?.rol === 'administrador');\n\n  login(username: string, password: string): void {\n    this.accesoApi.login(username, password).subscribe({\n      next: (resp) => {\n        if (resp.ok) {\n          this._isLoggedIn.set(true);\n          this._usuario.set(resp.usuario);\n          localStorage.setItem('username', resp.usuario.username);\n          localStorage.setItem('rol', resp.usuario.rol); // Guardamos rol\n          this.router.navigate(['/inicio']);\n        }\n      }\n    });\n  }\n\n  // Quitamos 'rol' de los argumentos de la función principal\nregistro(nombre: string, username: string, password: string, imagen: string): void {\n  // El rol se define aquí dentro antes de enviarlo a la API\n  const rol = 'usuario'; \n  \n  this.accesoApi.registro(nombre, username, password, imagen).subscribe({\n    next: (resp) => {\n      if (resp.ok) this.router.navigate(['/login']);\n    }\n  });\n}\n\n  logout(): void {\n    this._isLoggedIn.set(false);\n    this._usuario.set(null);\n    localStorage.clear();\n    this.router.navigate(['/login']);\n  }\n}"],"mappings":"AAAA,SAAqBA,MAAM,EAAEC,QAAQ,EAAEC,MAAM,QAAQ,eAAe;AACpE,SAASC,MAAM,QAAQ,iBAAiB;AACxC,SAASC,gBAAgB,QAAQ,sBAAsB;;AAGvD,OAAM,MAAOC,WAAW;EADxBC,YAAA;IAEU,KAAAC,SAAS,GAAGL,MAAM,CAACE,gBAAgB,CAAC;IACpC,KAAAI,MAAM,GAAGN,MAAM,CAACC,MAAM,CAAC;IAEvB,KAAAM,WAAW,GAAGT,MAAM,CAAC,KAAK,CAAC;IACnC,KAAAU,UAAU,GAAG,IAAI,CAACD,WAAW,CAACE,UAAU,EAAE;IAEnC,KAAAC,QAAQ,GAAGZ,MAAM,CAAa,IAAI,CAAC;IAC1C,KAAAa,OAAO,GAAG,IAAI,CAACD,QAAQ,CAACD,UAAU,EAAE;IAEpC;IACO,KAAAG,OAAO,GAAGb,QAAQ,CAAC,MAAM,IAAI,CAACW,QAAQ,EAAE,EAAEG,GAAG,KAAK,eAAe,CAAC;;EAEzEC,KAAKA,CAACC,QAAgB,EAAEC,QAAgB;IACtC,IAAI,CAACX,SAAS,CAACS,KAAK,CAACC,QAAQ,EAAEC,QAAQ,CAAC,CAACC,SAAS,CAAC;MACjDC,IAAI,EAAGC,IAAI,IAAI;QACb,IAAIA,IAAI,CAACC,EAAE,EAAE;UACX,IAAI,CAACb,WAAW,CAACc,GAAG,CAAC,IAAI,CAAC;UAC1B,IAAI,CAACX,QAAQ,CAACW,GAAG,CAACF,IAAI,CAACR,OAAO,CAAC;UAC/BW,YAAY,CAACC,OAAO,CAAC,UAAU,EAAEJ,IAAI,CAACR,OAAO,CAACI,QAAQ,CAAC;UACvDO,YAAY,CAACC,OAAO,CAAC,KAAK,EAAEJ,IAAI,CAACR,OAAO,CAACE,GAAG,CAAC,CAAC,CAAC;UAC/C,IAAI,CAACP,MAAM,CAACkB,QAAQ,CAAC,CAAC,SAAS,CAAC,CAAC;;MAErC;KACD,CAAC;EACJ;EAEA;EACFC,QAAQA,CAACC,MAAc,EAAEX,QAAgB,EAAEC,QAAgB,EAAEW,MAAc;IACzE;IACA,MAAMd,GAAG,GAAG,SAAS;IAErB,IAAI,CAACR,SAAS,CAACoB,QAAQ,CAACC,MAAM,EAAEX,QAAQ,EAAEC,QAAQ,EAAEW,MAAM,CAAC,CAACV,SAAS,CAAC;MACpEC,IAAI,EAAGC,IAAI,IAAI;QACb,IAAIA,IAAI,CAACC,EAAE,EAAE,IAAI,CAACd,MAAM,CAACkB,QAAQ,CAAC,CAAC,QAAQ,CAAC,CAAC;MAC/C;KACD,CAAC;EACJ;EAEEI,MAAMA,CAAA;IACJ,IAAI,CAACrB,WAAW,CAACc,GAAG,CAAC,KAAK,CAAC;IAC3B,IAAI,CAACX,QAAQ,CAACW,GAAG,CAAC,IAAI,CAAC;IACvBC,YAAY,CAACO,KAAK,EAAE;IACpB,IAAI,CAACvB,MAAM,CAACkB,QAAQ,CAAC,CAAC,QAAQ,CAAC,CAAC;EAClC;;;uBA5CWrB,WAAW;IAAA;EAAA;;;aAAXA,WAAW;MAAA2B,OAAA,EAAX3B,WAAW,CAAA4B,IAAA;MAAAC,UAAA,EADE;IAAM;EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}