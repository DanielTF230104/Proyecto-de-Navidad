{"ast":null,"code":"// /app/servicios/auth.service.ts\nimport { signal, computed } from '@angular/core'; // Añadimos computed\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"./acceso-api.service\";\nimport * as i2 from \"@angular/router\";\nexport class AuthService {\n  constructor(accesoApi, router) {\n    this.accesoApi = accesoApi;\n    this.router = router;\n    this.isLoggedIn = signal(false);\n    this.usuario = signal(null);\n    // NUEVO: Una señal computada para saber si es admin fácilmente\n    this.isAdmin = computed(() => this.usuario()?.rol === 'administrador');\n  }\n  login(username, password) {\n    this.accesoApi.login(username, password).subscribe({\n      next: response => {\n        if (response.ok) {\n          this.isLoggedIn.set(true);\n          this.usuario.set(response.usuario); // Aquí ya vendrá el rol e imagen\n          this.router.navigate(['/inicio']);\n        } else {\n          this.logout();\n        }\n      },\n      error: () => this.logout()\n    });\n  }\n  // Modificamos el registro para que acepte la imagen\n  registro(nombre, username, password, imagen = '') {\n    // Por defecto, al registrarse son 'usuario'\n    const rol = 'usuario';\n    this.accesoApi.registro(nombre, username, password, rol, imagen).subscribe({\n      next: response => {\n        if (response.ok) {\n          this.router.navigate(['/login']);\n        }\n      },\n      error: () => console.error('Error en el registro')\n    });\n  }\n  logout() {\n    this.isLoggedIn.set(false);\n    this.usuario.set(null);\n    this.router.navigate(['/login']);\n  }\n  static {\n    this.ɵfac = function AuthService_Factory(t) {\n      return new (t || AuthService)(i0.ɵɵinject(i1.AccesoApiService), i0.ɵɵinject(i2.Router));\n    };\n  }\n  static {\n    this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: AuthService,\n      factory: AuthService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n}","map":{"version":3,"names":["signal","computed","AuthService","constructor","accesoApi","router","isLoggedIn","usuario","isAdmin","rol","login","username","password","subscribe","next","response","ok","set","navigate","logout","error","registro","nombre","imagen","console","i0","ɵɵinject","i1","AccesoApiService","i2","Router","factory","ɵfac","providedIn"],"sources":["/usr/src/app/PROYECTO_NAVIDAD/PROYECTO_NAVIDAD/src/app/servicios/auth.service.ts"],"sourcesContent":["// /app/servicios/auth.service.ts\nimport { Injectable, signal, computed } from '@angular/core'; // Añadimos computed\nimport { AccesoApiService } from './acceso-api.service';\nimport { Router } from '@angular/router';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class AuthService {\n  public isLoggedIn = signal<boolean>(false);\n  public usuario = signal<any>(null);\n\n  // NUEVO: Una señal computada para saber si es admin fácilmente\n  public isAdmin = computed(() => this.usuario()?.rol === 'administrador');\n\n  constructor(\n    private accesoApi: AccesoApiService,\n    private router: Router\n  ) { }\n\n  login(username: string, password: string) {\n    this.accesoApi.login(username, password)\n      .subscribe({\n        next: (response) => {\n          if (response.ok) {\n            this.isLoggedIn.set(true);\n            this.usuario.set(response.usuario); // Aquí ya vendrá el rol e imagen\n            this.router.navigate(['/inicio']);\n          } else {\n            this.logout();\n          }\n        },\n        error: () => this.logout()\n      });\n  }\n\n  // Modificamos el registro para que acepte la imagen\n  registro(nombre: string, username: string, password: string, imagen: string = '') {\n    // Por defecto, al registrarse son 'usuario'\n    const rol = 'usuario'; \n    this.accesoApi.registro(nombre, username, password, rol, imagen)\n      .subscribe({\n        next: (response) => {\n          if (response.ok) {\n            this.router.navigate(['/login']);\n          }\n        },\n        error: () => console.error('Error en el registro')\n      });\n  }\n\n  logout() {\n    this.isLoggedIn.set(false);\n    this.usuario.set(null);\n    this.router.navigate(['/login']);\n  }\n}"],"mappings":"AAAA;AACA,SAAqBA,MAAM,EAAEC,QAAQ,QAAQ,eAAe,CAAC,CAAC;;;;AAO9D,OAAM,MAAOC,WAAW;EAOtBC,YACUC,SAA2B,EAC3BC,MAAc;IADd,KAAAD,SAAS,GAATA,SAAS;IACT,KAAAC,MAAM,GAANA,MAAM;IART,KAAAC,UAAU,GAAGN,MAAM,CAAU,KAAK,CAAC;IACnC,KAAAO,OAAO,GAAGP,MAAM,CAAM,IAAI,CAAC;IAElC;IACO,KAAAQ,OAAO,GAAGP,QAAQ,CAAC,MAAM,IAAI,CAACM,OAAO,EAAE,EAAEE,GAAG,KAAK,eAAe,CAAC;EAKpE;EAEJC,KAAKA,CAACC,QAAgB,EAAEC,QAAgB;IACtC,IAAI,CAACR,SAAS,CAACM,KAAK,CAACC,QAAQ,EAAEC,QAAQ,CAAC,CACrCC,SAAS,CAAC;MACTC,IAAI,EAAGC,QAAQ,IAAI;QACjB,IAAIA,QAAQ,CAACC,EAAE,EAAE;UACf,IAAI,CAACV,UAAU,CAACW,GAAG,CAAC,IAAI,CAAC;UACzB,IAAI,CAACV,OAAO,CAACU,GAAG,CAACF,QAAQ,CAACR,OAAO,CAAC,CAAC,CAAC;UACpC,IAAI,CAACF,MAAM,CAACa,QAAQ,CAAC,CAAC,SAAS,CAAC,CAAC;SAClC,MAAM;UACL,IAAI,CAACC,MAAM,EAAE;;MAEjB,CAAC;MACDC,KAAK,EAAEA,CAAA,KAAM,IAAI,CAACD,MAAM;KACzB,CAAC;EACN;EAEA;EACAE,QAAQA,CAACC,MAAc,EAAEX,QAAgB,EAAEC,QAAgB,EAAEW,MAAA,GAAiB,EAAE;IAC9E;IACA,MAAMd,GAAG,GAAG,SAAS;IACrB,IAAI,CAACL,SAAS,CAACiB,QAAQ,CAACC,MAAM,EAAEX,QAAQ,EAAEC,QAAQ,EAAEH,GAAG,EAAEc,MAAM,CAAC,CAC7DV,SAAS,CAAC;MACTC,IAAI,EAAGC,QAAQ,IAAI;QACjB,IAAIA,QAAQ,CAACC,EAAE,EAAE;UACf,IAAI,CAACX,MAAM,CAACa,QAAQ,CAAC,CAAC,QAAQ,CAAC,CAAC;;MAEpC,CAAC;MACDE,KAAK,EAAEA,CAAA,KAAMI,OAAO,CAACJ,KAAK,CAAC,sBAAsB;KAClD,CAAC;EACN;EAEAD,MAAMA,CAAA;IACJ,IAAI,CAACb,UAAU,CAACW,GAAG,CAAC,KAAK,CAAC;IAC1B,IAAI,CAACV,OAAO,CAACU,GAAG,CAAC,IAAI,CAAC;IACtB,IAAI,CAACZ,MAAM,CAACa,QAAQ,CAAC,CAAC,QAAQ,CAAC,CAAC;EAClC;;;uBA/CWhB,WAAW,EAAAuB,EAAA,CAAAC,QAAA,CAAAC,EAAA,CAAAC,gBAAA,GAAAH,EAAA,CAAAC,QAAA,CAAAG,EAAA,CAAAC,MAAA;IAAA;EAAA;;;aAAX5B,WAAW;MAAA6B,OAAA,EAAX7B,WAAW,CAAA8B,IAAA;MAAAC,UAAA,EAFV;IAAM;EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}