{"ast":null,"code":"import { signal, computed, inject } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { AccesoApiService } from './acceso-api.service';\nimport * as i0 from \"@angular/core\";\nexport class AuthService {\n  constructor() {\n    this.accesoApi = inject(AccesoApiService);\n    this.router = inject(Router);\n    this._isLoggedIn = signal(false);\n    this.isLoggedIn = this._isLoggedIn.asReadonly();\n    this._usuario = signal(null);\n    this.usuario = this._usuario.asReadonly();\n    // Requisito 1: Signal computado para saber si es Admin\n    // Signal que detecta si el usuario es admin\n    this.isAdmin = computed(() => {\n      const r = this._usuario()?.rol?.toLowerCase();\n      return r === 'administrador' || r === 'admin';\n    });\n  }\n  login(username, password) {\n    this.accesoApi.login(username, password).subscribe({\n      next: resp => {\n        // 1. Esto nos dirá qué tiene de raro el admin\n        console.log(\"Respuesta del servidor:\", resp);\n        // 2. Si la respuesta es un array, pillamos el primer elemento (común en Node/MySQL)\n        const user = Array.isArray(resp) ? resp[0] : resp;\n        // 3. Condición ultra-flexible para que te deje pasar siempre que haya datos\n        if (user && (user.username || user.id)) {\n          this._isLoggedIn.set(true);\n          this._usuario.set(user);\n          // Guardamos los datos para que el Guard y los Signals funcionen\n          localStorage.setItem('username', user.username);\n          localStorage.setItem('rol', user.rol);\n          console.log(\"Login de \" + user.rol + \" exitoso. Redirigiendo...\");\n          this.router.navigate(['/inicio']);\n        } else {\n          alert(\"Credenciales incorrectas o el usuario no existe en la DB\");\n        }\n      },\n      error: err => {\n        console.error(\"Error de conexión:\", err);\n        alert(\"Error crítico al conectar con Node\");\n      }\n    });\n  }\n  // Quitamos 'rol' de los argumentos de la función principal\n  registro(nombre, username, password, imagen, rol) {\n    // Pasamos el rol recibido al API Service\n    this.accesoApi.registro(nombre, username, password, imagen, rol).subscribe({\n      next: resp => {\n        if (resp.ok) {\n          alert(\"Usuario creado como: \" + rol);\n          this.router.navigate(['/login']);\n        }\n      }\n    });\n  }\n  logout() {\n    this._isLoggedIn.set(false);\n    this._usuario.set(null);\n    localStorage.clear();\n    this.router.navigate(['/login']);\n  }\n  static {\n    this.ɵfac = function AuthService_Factory(t) {\n      return new (t || AuthService)();\n    };\n  }\n  static {\n    this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: AuthService,\n      factory: AuthService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n}","map":{"version":3,"names":["signal","computed","inject","Router","AccesoApiService","AuthService","constructor","accesoApi","router","_isLoggedIn","isLoggedIn","asReadonly","_usuario","usuario","isAdmin","r","rol","toLowerCase","login","username","password","subscribe","next","resp","console","log","user","Array","isArray","id","set","localStorage","setItem","navigate","alert","error","err","registro","nombre","imagen","ok","logout","clear","factory","ɵfac","providedIn"],"sources":["/usr/src/app/PROYECTO_NAVIDAD/PROYECTO_NAVIDAD/src/app/servicios/auth.service.ts"],"sourcesContent":["import { Injectable, signal, computed, inject } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { AccesoApiService } from './acceso-api.service';\n\n@Injectable({ providedIn: 'root' })\nexport class AuthService {\n  private accesoApi = inject(AccesoApiService);\n  private router = inject(Router);\n\n  private _isLoggedIn = signal(false);\n  isLoggedIn = this._isLoggedIn.asReadonly();\n\n  public _usuario = signal<any | null>(null);\n  usuario = this._usuario.asReadonly();\n\n  // Requisito 1: Signal computado para saber si es Admin\n  // Signal que detecta si el usuario es admin\n  public isAdmin = computed(() => {\n    const r = this._usuario()?.rol?.toLowerCase();\n    return r === 'administrador' || r === 'admin';\n  });\n  login(username: string, password: string): void {\n    this.accesoApi.login(username, password).subscribe({\n      next: (resp) => {\n        // 1. Esto nos dirá qué tiene de raro el admin\n        console.log(\"Respuesta del servidor:\", resp);\n\n        // 2. Si la respuesta es un array, pillamos el primer elemento (común en Node/MySQL)\n        const user = Array.isArray(resp) ? resp[0] : resp;\n\n        // 3. Condición ultra-flexible para que te deje pasar siempre que haya datos\n        if (user && (user.username || user.id)) {\n          \n          this._isLoggedIn.set(true);\n          this._usuario.set(user);\n          \n          // Guardamos los datos para que el Guard y los Signals funcionen\n          localStorage.setItem('username', user.username);\n          localStorage.setItem('rol', user.rol);\n\n          console.log(\"Login de \" + user.rol + \" exitoso. Redirigiendo...\");\n          this.router.navigate(['/inicio']); \n        } else {\n          alert(\"Credenciales incorrectas o el usuario no existe en la DB\");\n        }\n      },\n      error: (err) => {\n        console.error(\"Error de conexión:\", err);\n        alert(\"Error crítico al conectar con Node\");\n      }\n    });\n  }\n\n  // Quitamos 'rol' de los argumentos de la función principal\n  registro(nombre: string, username: string, password: string, imagen: string, rol: string): void {\n  // Pasamos el rol recibido al API Service\n  this.accesoApi.registro(nombre, username, password, imagen, rol).subscribe({\n    next: (resp) => {\n      if (resp.ok) {\n        alert(\"Usuario creado como: \" + rol);\n        this.router.navigate(['/login']);\n      }\n    }\n  });\n}\n\n  logout(): void {\n    this._isLoggedIn.set(false);\n    this._usuario.set(null);\n    localStorage.clear();\n    this.router.navigate(['/login']);\n  }\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}