{"ast":null,"code":"import { signal, computed, inject } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { AccesoApiService } from './acceso-api.service';\nimport * as i0 from \"@angular/core\";\nexport class AuthService {\n  constructor() {\n    this.accesoApi = inject(AccesoApiService);\n    this.router = inject(Router);\n    this._isLoggedIn = signal(false);\n    this.isLoggedIn = this._isLoggedIn.asReadonly();\n    this._usuario = signal(null);\n    this.usuario = this._usuario.asReadonly();\n    // Requisito 1: Signal computado para saber si es Admin\n    // Signal que detecta si el usuario es admin\n    // En auth.service.ts\n    this.isAdmin = computed(() => {\n      const r = this._usuario()?.rol;\n      // Añadimos todas las opciones posibles para no fallar mañana\n      return r === 'administrador' || r === 'admin' || r === 'ADMIN';\n    });\n  }\n  login(username, password) {\n    this.accesoApi.login(username, password).subscribe({\n      next: resp => {\n        console.log(\"Datos recibidos:\", resp);\n        // 1. Intentamos sacar el usuario si viene en un array o directo\n        let user = null;\n        if (Array.isArray(resp) && resp.length > 0) {\n          user = resp[0]; // Si es un array (típico de MySQL/admin), pillamos el primero\n        } else if (resp && !Array.isArray(resp)) {\n          user = resp; // Si es un objeto directo (usuario normal), lo pillamos tal cual\n        }\n        // 2. Verificamos si tenemos un usuario real antes de navegar\n        if (user && (user.username || user.id)) {\n          this._isLoggedIn.set(true);\n          this._usuario.set(user);\n          localStorage.setItem('username', user.username);\n          localStorage.setItem('rol', user.rol);\n          this.router.navigate(['/inicio']);\n        } else {\n          alert(\"Usuario o contraseña incorrectos\");\n        }\n      },\n      error: err => {\n        console.error(\"Error de conexión:\", err);\n        alert(\"Error al conectar con el servidor de Node\");\n      }\n    });\n  }\n  // Quitamos 'rol' de los argumentos de la función principal\n  registro(nombre, username, password, imagen, rol) {\n    // Pasamos el rol recibido al API Service\n    this.accesoApi.registro(nombre, username, password, imagen, rol).subscribe({\n      next: resp => {\n        if (resp.ok) {\n          alert(\"Usuario creado como: \" + rol);\n          this.router.navigate(['/login']);\n        }\n      }\n    });\n  }\n  logout() {\n    this._isLoggedIn.set(false);\n    this._usuario.set(null);\n    localStorage.clear();\n    this.router.navigate(['/login']);\n  }\n  static {\n    this.ɵfac = function AuthService_Factory(t) {\n      return new (t || AuthService)();\n    };\n  }\n  static {\n    this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: AuthService,\n      factory: AuthService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n}","map":{"version":3,"names":["signal","computed","inject","Router","AccesoApiService","AuthService","constructor","accesoApi","router","_isLoggedIn","isLoggedIn","asReadonly","_usuario","usuario","isAdmin","r","rol","login","username","password","subscribe","next","resp","console","log","user","Array","isArray","length","id","set","localStorage","setItem","navigate","alert","error","err","registro","nombre","imagen","ok","logout","clear","factory","ɵfac","providedIn"],"sources":["/usr/src/app/PROYECTO_NAVIDAD/PROYECTO_NAVIDAD/src/app/servicios/auth.service.ts"],"sourcesContent":["import { Injectable, signal, computed, inject } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { AccesoApiService } from './acceso-api.service';\n\n@Injectable({ providedIn: 'root' })\nexport class AuthService {\n  private accesoApi = inject(AccesoApiService);\n  private router = inject(Router);\n\n  private _isLoggedIn = signal(false);\n  isLoggedIn = this._isLoggedIn.asReadonly();\n\n  public _usuario = signal<any | null>(null);\n  usuario = this._usuario.asReadonly();\n\n  // Requisito 1: Signal computado para saber si es Admin\n  // Signal que detecta si el usuario es admin\n  // En auth.service.ts\n  public isAdmin = computed(() => {\n    const r = this._usuario()?.rol;\n    // Añadimos todas las opciones posibles para no fallar mañana\n    return r === 'administrador' || r === 'admin' || r === 'ADMIN';\n  });\n  login(username: string, password: string): void {\n  this.accesoApi.login(username, password).subscribe({\n    next: (resp) => {\n      console.log(\"Datos recibidos:\", resp);\n\n      // 1. Intentamos sacar el usuario si viene en un array o directo\n      let user = null;\n      if (Array.isArray(resp) && resp.length > 0) {\n        user = resp[0]; // Si es un array (típico de MySQL/admin), pillamos el primero\n      } else if (resp && !Array.isArray(resp)) {\n        user = resp; // Si es un objeto directo (usuario normal), lo pillamos tal cual\n      }\n\n      // 2. Verificamos si tenemos un usuario real antes de navegar\n      if (user && (user.username || user.id)) {\n        this._isLoggedIn.set(true);\n        this._usuario.set(user);\n        \n        localStorage.setItem('username', user.username);\n        localStorage.setItem('rol', user.rol);\n\n        this.router.navigate(['/inicio']);\n      } else {\n        alert(\"Usuario o contraseña incorrectos\");\n      }\n    },\n    error: (err) => {\n      console.error(\"Error de conexión:\", err);\n      alert(\"Error al conectar con el servidor de Node\");\n    }\n  });\n}\n\n  // Quitamos 'rol' de los argumentos de la función principal\n  registro(nombre: string, username: string, password: string, imagen: string, rol: string): void {\n  // Pasamos el rol recibido al API Service\n  this.accesoApi.registro(nombre, username, password, imagen, rol).subscribe({\n    next: (resp) => {\n      if (resp.ok) {\n        alert(\"Usuario creado como: \" + rol);\n        this.router.navigate(['/login']);\n      }\n    }\n  });\n}\n\n  logout(): void {\n    this._isLoggedIn.set(false);\n    this._usuario.set(null);\n    localStorage.clear();\n    this.router.navigate(['/login']);\n  }\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}